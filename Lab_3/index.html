<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>ЛР-3 · Продукты · Значки</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      /* палитра в духе сайта: глубокий синий + светлые линии + красный лейбл */
      --bg:#0b2d63;            /* фон */
      --bg-grad:#0b2d63 linear-gradient(180deg,#0b2d63 0%,#0a3f8a 55%,#0b2d63 100%);
      --card:#0e3b78;          /* плитки */
      --card-2:#114a98;
      --line:#3a67b5;          /* линии/бордеры */
      --text:#eef3ff;          /* основной текст */
      --muted:#b8c7f1;         /* вторичный текст */
      --accent:#2b7cff;        /* синий акцент на кнопках */
      --accent-hover:#4d93ff;
      --red:#ff3b30;           /* маленький красный бейдж */
    }
    *{box-sizing:border-box}
    body{margin:0;font:15px/1.45 system-ui,Segoe UI,Roboto,Arial;color:var(--text);background:var(--bg-grad)}
    a{color:inherit;text-decoration:none}

    header{position:sticky;top:0;z-index:10;background:#092a5ae6;
      backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .wrap{max-width:1060px;margin:0 auto;padding:14px 18px;display:flex;gap:12px;align-items:center}
    .brand{font-weight:700;letter-spacing:.2px}
    .sp{flex:1}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:transparent;cursor:pointer;color:var(--text)}
    .btn:hover{background:#0a3f8a77}
    .btn.acc{background:var(--accent);border-color:transparent;color:#061933}
    .btn.acc:hover{background:var(--accent-hover)}

    main{max-width:1060px;margin:0 auto;padding:18px}
    .controls{display:flex;gap:12px;margin:8px 0 16px}
    .in{flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--line);
        background:#0a2f66;color:var(--text)}
    .icons{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(130px,1fr))}
    .icon-card{background:linear-gradient(180deg,var(--card),var(--card-2));
      border:1px solid var(--line);border-radius:14px;padding:12px;text-align:center;
      box-shadow:0 6px 14px rgba(0,0,0,.15)}
    .glyph{display:grid;place-items:center;font-size:34px;width:76px;height:76px;margin:0 auto 8px;
      border-radius:50%;background:#0b2f66;border:1px solid var(--line)}
    .badge{font-size:12px;color:var(--muted)}
    .price{font-weight:700;margin-top:2px}
    .tag{display:inline-block;background:var(--red);color:#fff;font-size:11px;
      padding:2px 6px;border-radius:6px;margin-bottom:6px;letter-spacing:.2px}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">ЛР-3 · Продукты</div>
    <div class="sp"></div>
    <a class="btn" href="index.html">Домой</a>
  </div>
</header>

<main>
  <div class="controls">
    <input id="q" class="in" placeholder="Фильтр: название / категория" />
    <button id="add" class="btn acc">Добавить копию первой</button>
  </div>

  <section id="icons" class="icons"></section>
</main>

<script>
async function load(){ const r=await fetch('./data.json',{cache:'no-store'}); return r.json(); }
const grid=document.getElementById('icons');
let items=[];

function money(x){return new Intl.NumberFormat('ru-RU',{style:'currency',currency:'RUB',maximumFractionDigits:0}).format(x);}

function card(it){
  return `
  <article class="icon-card" data-id="${it.id}" title="${it.short}">
    <div class="tag">товар</div>
    <a class="glyph" href="details.html?id=${encodeURIComponent(it.id)}">${it.emoji}</a>
    <div style="font-weight:700">${it.name}</div>
    <div class="badge">${it.category}</div>
    <div class="price">${money(it.price)}</div>
    <div style="margin-top:8px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <a class="btn" href="details.html?id=${encodeURIComponent(it.id)}">Подробнее</a>
      <button class="btn" data-action="rm">Удалить</button>
    </div>
  </article>`;
}

function render(list){ grid.innerHTML=list.map(card).join(''); }

document.getElementById('q').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase().trim();
  render(!q?items:items.filter(x=>x.name.toLowerCase().includes(q)||x.category.toLowerCase().includes(q)));
});

document.getElementById('add').addEventListener('click',()=>{
  if(!items.length) return;
  const copy={...items[0], id:'copy-'+Date.now(), name:items[0].name+' (копия)'};
  items=[copy,...items]; render(items);
});

grid.addEventListener('click',e=>{
  const btn=e.target.closest('button[data-action="rm"]'); if(!btn) return;
  const card=btn.closest('.icon-card'); const id=card.dataset.id;
  items=items.filter(x=>x.id!==id); card.remove();
});

load().then(d=>{ items=d; render(items); });
</script>
</body>
</html>
